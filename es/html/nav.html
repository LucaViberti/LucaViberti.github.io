<header>
  <div class="site-info">
    <h1 class="site-title">TopHeroes Guide</h1>
  </div>
  <nav>
    <ul>
      <li><a href="/es/index.html">Inicio</a></li>

      <li class="lang-switcher">
        <label for="language-select" class="lang-label">Idioma</label>
        <select id="language-select" aria-label="Seleccionar idioma">
          <option value="en">English</option>
          <option value="it">Italiano</option>
          <option value="es">Español</option>
        </select>
      </li>

      <!-- HEROES -->
      <li class="has-sub">
        <a href="/es/html/heroes.html">Héroes</a>
        <ul class="dropdown">
          <li><a href="/es/html/heroes.html">Resumen</a></li>
          <li><a href="/es/html/league.html">League</a></li>
          <li><a href="/es/html/nature.html">Naturaleza</a></li>
          <li><a href="/es/html/horde.html">Horde</a></li>
          <!-- Gear con mini flyout affianco -->
          <li class="has-flyout">
            <a href="/es/html/gear.html">Equipo</a>
            <button class="flyout-toggle" aria-label="Más sobre Equipo" aria-expanded="false" aria-controls="gear-flyout">▾</button>
            <ul id="gear-flyout" class="flyout">
              <li><a href="/es/html/exclusive-gear.html">Equipo exclusivo</a></li>
            </ul>
          </li>
          <li><a href="/es/html/pets.html">Mascotas</a></li>
        </ul>
      </li>

      <!-- BUILDING -->
      <li class="has-sub">
        <a href="/es/html/building.html">Construcción</a>
        <ul class="dropdown">
          <li><a href="/es/html/building.html">Resumen</a></li>
          <li><a href="/es/html/villagers.html">Aldeanos</a></li>
          <li><a href="/es/html/lord-gear.html">Equipo de Lord</a></li>
          <li><a href="/es/html/relic.html">Sala de Reliquias</a></li>
        </ul>
      </li>

      <li><a href="/es/html/research.html">Investigación</a></li>

      <!-- ADVENTURE -->
      <li class="has-sub">
        <a href="/es/html/generaladv.html">Aventura</a>
        <ul class="dropdown">
          <li><a href="/es/html/generaladv.html">Resumen</a></li>
          <li><a href="/es/html/classicadv.html">Clásico</a></li>
          <li><a href="/es/html/seasononeadv.html">Temporada 1</a></li>
        </ul>
      </li>

      <!-- EVENTS  -->
      <li class="has-sub">
        <a href="/es/html/events.html">Eventos</a>
        <ul class="dropdown">
          <li><a href="/es/html/guild-race.html">Carrera de Gremio</a></li>
          <li><a href="/es/html/arms-race.html">Carrera de Armas</a></li>
          <li><a href="/es/html/kingdom.html">KvK</a></li>
          <li><a href="/es/html/guildboss.html">Guild Boss</a></li>
        </ul>
      </li>

      <li><a href="/es/html/beginners.html">Guía para Principiantes</a></li>
      <li><a href="/es/html/shop.html">TIENDA</a></li>
      <li><a href="/es/html/tips.html">Tablas de Costes</a></li>
      <li><a href="/es/html/quick-tips.html">Consejos Rápidos</a></li>

      <!-- SUPPORT US -->
      <li class="has-sub">
        <a href="#">Apóyanos</a>
        <ul class="dropdown">
          <li><a href="https://ko-fi.com/landaadvice" target="_blank" rel="noopener noreferrer">Ko-fi</a></li>
          <li><a href="https://donate.stripe.com/8x29AT3q37Sl4BJg127AI00" target="_blank" rel="noopener noreferrer">Donar con Stripe</a></li>
        </ul>
      </li>

      <li><a href="/es/html/privacy.html">Política y Privacidad</a></li>
    </ul>
  </nav>
</header>

<style>
  /* dimensione link coerente */
  nav ul li a { font-size: 0.85rem; }
  nav ul li ul li a { font-size: 0.85rem; }

  /* Titolo */
  .site-title{
    font-size: clamp(1.8rem, 4vw, 2.5rem);
    font-weight:700;
    background: linear-gradient(90deg,#29abe0,#7dd3fc);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    text-align:center;margin:0;padding:8px 0;
    text-shadow:0 2px 4px rgba(0,0,0,0.3);
  }

  /* Dropdown base */
  nav ul{list-style:none;margin:0;padding:0;display:flex;justify-content:center;flex-wrap:wrap;gap:20px}
  nav ul li{position:relative}
  nav ul li a{
    color:#ccd0dd;text-decoration:none;text-transform:uppercase;font-weight:500;letter-spacing:.05em;
    padding:12px 6px;border-bottom:2px solid transparent;transition:color .3s,border-bottom-color .3s
  }
  nav ul li a:hover{color:#fff;border-bottom-color:#29abe0}

  /* dropdown principale */
  nav ul li .dropdown{
    display:none;position:absolute;top:100%;left:50%;transform:translateX(-50%);
    background:#1c2133;border:1px solid #2b2f3a;border-radius:6px;padding:10px 0;min-width:220px;z-index:1000
  }
  @media (hover:hover){
    nav ul li.has-sub:hover > .dropdown{display:block}
  }
  nav ul li.has-sub.open > .dropdown{display:block}

  nav ul li .dropdown li a{
    display:block;padding:8px 16px;color:#d1d1d6;white-space:nowrap;border-bottom:0;text-transform:none;letter-spacing:0
  }
  nav ul li .dropdown li a:hover{background:#25314d;color:#fff}

  /* Gear con flyout */
  .has-flyout{position:relative;display:flex;align-items:center;justify-content:space-between;gap:8px;padding:0 10px}
  .has-flyout > a{flex:1;padding:8px 8px}
  .flyout-toggle{
    background:linear-gradient(180deg,#2b3654 0%,#232c47 100%);
    border:1px solid #2b2f3a;border-radius:8px;padding:6px 10px;
    color:#d1d1d6;cursor:pointer;font-size:.8rem;line-height:1;transition:background .2s,color .2s,transform .2s;
  }
  .flyout-toggle:hover{background:#2f3a5c;color:#fff;transform:translateY(-1px)}
  .flyout{
    display:none;position:absolute;
    top:50%; left:100%; transform:translateY(-50%);
    margin-left:12px;
    background:#1c2133;border:1px solid #2b2f3a;border-radius:10px;min-width:190px; padding:10px 0; z-index:1001;
    box-shadow:0 12px 28px rgba(0,0,0,.35);
  }
  .flyout::before{
    content:"";position:absolute;left:-6px;top:50%;transform:translateY(-50%) rotate(45deg);
    width:12px;height:12px;background:#1c2133;border-left:1px solid #2b2f3a;border-bottom:1px solid #2b2f3a;
  }
  @media (hover:hover){
    .has-flyout:hover > .flyout{display:block}
  }
  .has-flyout.open > .flyout{display:block}
  @media (max-width: 640px){
    .flyout{position:static; margin:6px 0 0 0; left:auto; top:auto; transform:none; display:none; box-shadow:none;}
    .flyout::before{display:none}
    .has-flyout.open > .flyout{display:block}
    .has-flyout{flex-wrap:wrap}
    .flyout-toggle{padding:6px 10px}
  }


  .lang-switcher{display:flex;align-items:center;gap:8px}
  .lang-label{color:#ccd0dd;font-size:.8rem;text-transform:uppercase;letter-spacing:.04em}
  #language-select{
    background:#1c2133;color:#fff;border:1px solid #2b2f3a;border-radius:8px;
    padding:6px 10px;font-size:.85rem;
  }
  #language-select:focus{outline:2px solid #29abe0;outline-offset:1px}

  /* FIX: garantisce click sicuri */
  nav { position: relative; z-index: 10; }
  nav ul li .dropdown li a { position: relative; z-index: 2; }
</style>

<script>
  // Evidenzia la pagina attiva
  (function(){
    const current = (location.pathname.split("/").pop() || "index.html").toLowerCase();
    document.querySelectorAll('nav a[href]').forEach(a=>{
      const href = a.getAttribute('href')?.toLowerCase();
      if(href === current){
        a.style.color = '#fff';
        a.style.borderBottomColor = '#29abe0';
      }
    });
  })();

  // Apertura/chiusura dropdown (mobile) + 2° tap = naviga
  (function(){
    const isTouch = window.matchMedia('(hover: none)').matches;

    document.querySelectorAll('nav li.has-sub > a').forEach(link=>{
      link.addEventListener('click', function(e){
        const li = this.parentElement;
        if (!isTouch) return; // desktop normale

        if (!li.classList.contains('open')) {
          e.preventDefault();
          li.classList.add('open');
          document.querySelectorAll('nav li.has-sub').forEach(other=>{
            if(other !== li) other.classList.remove('open');
          });
          return;
        }
      });
    });

    // voci interne navigano sempre
    document.querySelectorAll('nav li .dropdown a').forEach(a=>{
      a.addEventListener('click', e=>{
        e.stopPropagation();
      });
    });

    // Gear flyout
    document.querySelectorAll('.has-flyout .flyout-toggle').forEach(btn=>{
      btn.addEventListener('click', function(e){
        e.stopPropagation();
        const li = this.closest('.has-flyout');
        const expanded = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', expanded ? 'false' : 'true');
        li.classList.toggle('open', !expanded);
      });
    });

    // Chiudi fuori
    document.addEventListener('click', function(e){
      const nav = document.querySelector('nav');
      if(!nav.contains(e.target)){
        document.querySelectorAll('nav li.has-sub').forEach(li=>li.classList.remove('open'));
        document.querySelectorAll('.has-flyout .flyout-toggle').forEach(btn=>btn.setAttribute('aria-expanded','false'));
        document.querySelectorAll('.has-flyout').forEach(li=>li.classList.remove('open'));
      }
    });

    // Chiudi con Esc
    document.addEventListener('keydown', function(e){
      if(e.key === 'Escape'){
        document.querySelectorAll('nav li.has-sub').forEach(li=>li.classList.remove('open'));
        document.querySelectorAll('.has-flyout .flyout-toggle').forEach(btn=>btn.setAttribute('aria-expanded','false'));
        document.querySelectorAll('.has-flyout').forEach(li=>li.classList.remove('open'));
      }
    });
  })();
</script>
