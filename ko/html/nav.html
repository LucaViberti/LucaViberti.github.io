<header>
  <div class="site-info">
    <h1 class="site-title">TopHeroes 가이드</h1>
    <!-- Language Selector in Header -->
    <div id="header-lang-selector" class="header-lang-selector"></div>
  </div>
  <nav>
    <ul>
      <li><a href="/ko/index.html">홈</a></li>

      <!-- HEROES -->
      <li class="has-sub">
        <a href="/ko/html/heroes.html">영웅</a>
        <ul class="dropdown">
          <li><a href="/ko/html/heroes.html">개요</a></li>
          <li><a href="/ko/html/league.html">연맹</a></li>
          <li><a href="/ko/html/nature.html">자연</a></li>
          <li><a href="/ko/html/horde.html">호드</a></li>
          <!-- Gear con mini flyout affianco -->
          <li class="has-flyout">
            <a href="/ko/html/gear.html">장비</a>
            <button class="flyout-toggle" aria-label="장비에 대한 자세한 정보" aria-expanded="false" aria-controls="gear-flyout">▾</button>
            <ul id="gear-flyout" class="flyout">
              <li><a href="/ko/html/exclusive-gear.html">독점 장비</a></li>
            </ul>
          </li>
          <li><a href="/ko/html/pets.html">애완동물</a></li>
        </ul>
      </li>

      <!-- BUILDING -->
      <li class="has-sub">
        <a href="/ko/html/building.html">건설</a>
        <ul class="dropdown">
          <li><a href="/ko/html/building.html">개요</a></li>
          <li><a href="/ko/html/villagers.html">마을 주민</a></li>
          <li><a href="/ko/html/lord-gear.html">영주 장비</a></li>
          <li><a href="/ko/html/relic.html">유물관</a></li>
        </ul>
      </li>

      <li><a href="/ko/html/research.html">연구</a></li>

      <!-- ADVENTURE -->
      <li class="has-sub">
        <a href="/ko/html/generaladv.html">모험</a>
        <ul class="dropdown">
          <li><a href="/ko/html/generaladv.html">개요</a></li>
          <li><a href="/ko/html/classicadv.html">클래식</a></li>
          <li><a href="/ko/html/seasononeadv.html">시즌 1</a></li>
        </ul>
      </li>

      <!-- EVENTS  -->
      <li class="has-sub">
        <a href="/ko/html/events.html">이벤트</a>
        <ul class="dropdown">
          <li><a href="/ko/html/guild-race.html">길드 경주</a></li>
          <li><a href="/ko/html/arms-race.html">무기 경주</a></li>
          <li><a href="/ko/html/kingdom.html">KvK</a></li>
          <li><a href="/ko/html/guildboss.html">길드 보스</a></li>
        </ul>
      </li>

      <li><a href="/ko/html/beginners.html">초보자 가이드</a></li>
      <li><a href="/ko/html/shop.html">상점</a></li>
      <li><a href="/ko/html/tips.html">비용 표</a></li>
      <li><a href="/ko/html/quick-tips.html">빠른 팁</a></li>

      <!-- SUPPORT US -->
      <li class="has-sub">
        <a href="#">우리를 지원하세요</a>
        <ul class="dropdown">
          <li><a href="https://ko-fi.com/landaadvice" target="_blank" rel="noopener noreferrer">Ko-fi</a></li>
          <li><a href="https://donate.stripe.com/8x29AT3q37Sl4BJg127AI00" target="_blank" rel="noopener noreferrer">Stripe로 기부하기</a></li>
        </ul>
      </li>

      <li><a href="/ko/html/privacy.html">정책 및 개인정보보호</a></li>
    </ul>
  </nav>
</header>

<style>
  /* dimensione link coerente */
  nav ul li a { font-size: 0.85rem; }
  nav ul li ul li a { font-size: 0.85rem; }

  /* Titolo */
  .site-title{
    font-size: clamp(1.8rem, 4vw, 2.5rem);
    font-weight:700;
    background: linear-gradient(90deg,#29abe0,#7dd3fc);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    text-align:center;margin:0;padding:8px 0;
    text-shadow:0 2px 4px rgba(0,0,0,0.3);
  }

  /* Language Selector in Header - Modern Style */
  .header-lang-selector {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    margin-top: 10px;
    padding: 8px 16px;
    background: rgba(41, 171, 224, 0.1);
    border-radius: 12px;
    backdrop-filter: blur(10px);
  }

  .header-lang-selector .lang-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    border-radius: 8px;
    background: transparent;
    border: 2px solid transparent;
    color: #b0b6c7;
    font-size: 0.9rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .header-lang-selector .lang-btn:hover {
    background: rgba(41, 171, 224, 0.15);
    color: #fff;
    transform: translateY(-2px);
  }

  .header-lang-selector .lang-btn.active {
    background: linear-gradient(135deg, #29abe0, #7dd3fc);
    border-color: #29abe0;
    color: #fff;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(41, 171, 224, 0.3);
  }

  .header-lang-selector .lang-flag {
    font-size: 1.2rem;
    line-height: 1;
  }

  @media (max-width: 640px) {
    .header-lang-selector {
      padding: 6px 12px;
      gap: 6px;
    }
    .header-lang-selector .lang-btn {
      padding: 5px 10px;
      font-size: 0.85rem;
    }
  }

  /* Dropdown base */
  nav ul{list-style:none;margin:0;padding:0;display:flex;justify-content:center;flex-wrap:wrap;gap:20px}
  nav ul li{position:relative}
  nav ul li a{
    color:#ccd0dd;text-decoration:none;text-transform:uppercase;font-weight:500;letter-spacing:.05em;
    padding:12px 6px;border-bottom:2px solid transparent;transition:color .3s,border-bottom-color .3s
  }
  nav ul li a:hover{color:#fff;border-bottom-color:#29abe0}

  /* dropdown principale */
  nav ul li .dropdown{
    display:none;position:absolute;top:100%;left:50%;transform:translateX(-50%);
    background:#1c2133;border:1px solid #2b2f3a;border-radius:6px;padding:10px 0;min-width:220px;z-index:1000
  }
  @media (hover:hover){
    nav ul li.has-sub:hover > .dropdown{display:block}
  }
  nav ul li.has-sub.open > .dropdown{display:block}

  nav ul li .dropdown li a{
    display:block;padding:8px 16px;color:#d1d1d6;white-space:nowrap;border-bottom:0;text-transform:none;letter-spacing:0
  }
  nav ul li .dropdown li a:hover{background:#25314d;color:#fff}

  /* Gear con flyout */
  .has-flyout{position:relative;display:flex;align-items:center;justify-content:space-between;gap:8px;padding:0 10px}
  .has-flyout > a{flex:1;padding:8px 8px}
  .flyout-toggle{
    background:linear-gradient(180deg,#2b3654 0%,#232c47 100%);
    border:1px solid #2b2f3a;border-radius:8px;padding:6px 10px;
    color:#d1d1d6;cursor:pointer;font-size:.8rem;line-height:1;transition:background .2s,color .2s,transform .2s;
  }
  .flyout-toggle:hover{background:#2f3a5c;color:#fff;transform:translateY(-1px)}
  .flyout{
    display:none;position:absolute;
    top:50%; left:100%; transform:translateY(-50%);
    margin-left:12px;
    background:#1c2133;border:1px solid #2b2f3a;border-radius:10px;min-width:190px; padding:10px 0; z-index:1001;
    box-shadow:0 12px 28px rgba(0,0,0,.35);
  }
  .flyout::before{
    content:"";position:absolute;left:-6px;top:50%;transform:translateY(-50%) rotate(45deg);
    width:12px;height:12px;background:#1c2133;border-left:1px solid #2b2f3a;border-bottom:1px solid #2b2f3a;
  }
  @media (hover:hover){
    .has-flyout:hover > .flyout{display:block}
  }
  .has-flyout.open > .flyout{display:block}
  @media (max-width: 640px){
    .flyout{position:static; margin:6px 0 0 0; left:auto; top:auto; transform:none; display:none; box-shadow:none;}
    .flyout::before{display:none}
    .has-flyout.open > .flyout{display:block}
    .has-flyout{flex-wrap:wrap}
    .flyout-toggle{padding:6px 10px}
  }

  /* FIX: garantisce click sicuri */
  nav { position: relative; z-index: 10; }
  nav ul li .dropdown li a { position: relative; z-index: 2; }
</style>

<script src="/lang-switcher.js"></script>
<script>
  // Initialize language selector in header
  if (typeof LangSwitcher !== 'undefined') {
    LangSwitcher.initHeaderSelector('header-lang-selector');
  }

  // Evidenzia la pagina attiva
  (function(){
    const current = (location.pathname.split("/").pop() || "index.html").toLowerCase();
    document.querySelectorAll('nav a[href]').forEach(a=>{
      const href = a.getAttribute('href')?.toLowerCase();
      if(href === current){
        a.style.color = '#fff';
        a.style.borderBottomColor = '#29abe0';
      }
    });
  })();

  // Apertura/chiusura dropdown (mobile) + 2° tap = naviga
  (function(){
    const isTouch = window.matchMedia('(hover: none)').matches;

    document.querySelectorAll('nav li.has-sub > a').forEach(link=>{
      link.addEventListener('click', function(e){
        const li = this.parentElement;
        if (!isTouch) return; // desktop normale

        if (!li.classList.contains('open')) {
          e.preventDefault();
          li.classList.add('open');
          document.querySelectorAll('nav li.has-sub').forEach(other=>{
            if(other !== li) other.classList.remove('open');
          });
          return;
        }
      });
    });

    // voci interne navigano sempre
    document.querySelectorAll('nav li .dropdown a').forEach(a=>{
      a.addEventListener('click', e=>{
        e.stopPropagation();
      });
    });

    // Gear flyout
    document.querySelectorAll('.has-flyout .flyout-toggle').forEach(btn=>{
      btn.addEventListener('click', function(e){
        e.stopPropagation();
        const li = this.closest('.has-flyout');
        const expanded = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', expanded ? 'false' : 'true');
        li.classList.toggle('open', !expanded);
      });
    });

    // Chiudi fuori
    document.addEventListener('click', function(e){
      const nav = document.querySelector('nav');
      if(!nav.contains(e.target)){
        document.querySelectorAll('nav li.has-sub').forEach(li=>li.classList.remove('open'));
        document.querySelectorAll('.has-flyout .flyout-toggle').forEach(btn=>btn.setAttribute('aria-expanded','false'));
        document.querySelectorAll('.has-flyout').forEach(li=>li.classList.remove('open'));
      }
    });

    // Chiudi con Esc
    document.addEventListener('keydown', function(e){
      if(e.key === 'Escape'){
        document.querySelectorAll('nav li.has-sub').forEach(li=>li.classList.remove('open'));
        document.querySelectorAll('.has-flyout .flyout-toggle').forEach(btn=>btn.setAttribute('aria-expanded','false'));
        document.querySelectorAll('.has-flyout').forEach(li=>li.classList.remove('open'));
      }
    });
  })();
</script>
