<header>
  <div class="site-info">
    <h1 class="site-title">TopHeroes Guide</h1>
  </div>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>

      <!-- HEROES -->
      <li class="has-sub">
        <a href="heroes.html">Heroes</a>
        <ul class="dropdown">
          <li><a href="heroes.html">Overview</a></li>
          <li><a href="league.html">League</a></li>
          <li><a href="nature.html">Nature</a></li>
          <li><a href="horde.html">Horde</a></li>

          <!-- Gear con flyout affianco -->
          <li class="has-flyout">
            <a href="gear.html">Gear</a>
            <button class="flyout-toggle" aria-label="More for Gear" aria-expanded="false" aria-controls="gear-flyout">
              <span class="chev">▾</span>
            </button>
            <ul id="gear-flyout" class="flyout" role="menu" aria-label="Gear submenu">
              <li><a href="exclusive-gear.html" role="menuitem">Exclusive Gear</a></li>
            </ul>
          </li>

          <li><a href="pets.html">Pets</a></li>
        </ul>
      </li>

      <!-- BUILDING -->
      <li class="has-sub">
        <a href="building.html">Building</a>
        <ul class="dropdown">
          <li><a href="building.html">Overview</a></li>
          <li><a href="villagers.html">Villagers</a></li>
          <li><a href="lord-gear.html">Lord Gear & Relics</a></li>
        </ul>
      </li>

      <li><a href="research.html">Research</a></li>
      <li><a href="adventure.html">Adventure</a></li>

      <!-- EVENTS -->
      <li class="has-sub">
        <a href="events.html">Events</a>
        <ul class="dropdown">
          <li><a href="guild-race.html">Guild Race</a></li>
          <li><a href="arms-race.html">Arms Race</a></li>
          <li><a href="kingdom.html">KvK</a></li>
          <li><a href="guildboss.html">Guild Boss</a></li>
        </ul>
      </li>

      <li><a href="beginners.html">Beginners Guide</a></li>
      <li><a href="shop.html">SHOP</a></li>
      <li><a href="tips.html">Tips & More</a></li>
      <li><a href="https://ko-fi.com/landaadvice" target="_blank" rel="noopener noreferrer">Support Us</a></li>
    </ul>
  </nav>
</header>

<style>
  /* dimensione link coerente */
  nav ul li a { font-size: 0.85rem; }
  nav ul li ul li a { font-size: 0.85rem; }

  /* Titolo */
  .site-title{
    font-size: clamp(1.8rem, 4vw, 2.5rem);
    font-weight:700;
    background: linear-gradient(90deg,#29abe0,#7dd3fc);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    text-align:center;margin:0;padding:8px 0;
    text-shadow:0 2px 4px rgba(0,0,0,0.3);
  }

  /* Base nav (stesso look delle altre pagine) */
  nav ul{list-style:none;margin:0;padding:0;display:flex;justify-content:center;flex-wrap:wrap;gap:20px}
  nav ul li{position:relative}
  nav ul li a{
    color:#ccd0dd;text-decoration:none;text-transform:uppercase;font-weight:500;letter-spacing:.05em;
    padding:12px 6px;border-bottom:2px solid transparent;transition:color .3s,border-bottom-color .3s
  }
  nav ul li a:hover{color:#fff;border-bottom-color:#29abe0}

  /* Dropdown principale */
  nav ul li .dropdown{
    display:none;position:absolute;top:100%;left:50%;transform:translateX(-50%);
    background:#1c2133;border:1px solid #2b2f3a;border-radius:10px;padding:10px 0;min-width:220px;z-index:1000;
    box-shadow:0 10px 24px rgba(0,0,0,.35)
  }

  /* Desktop: apri su hover */
  @media (hover:hover){
    nav ul li.has-sub:hover > .dropdown{display:block}
  }

  /* Mobile/JS: apri con classe .open */
  nav ul li.has-sub.open > .dropdown{display:block}

  /* Voci dentro il dropdown */
  nav ul li .dropdown li a{
    display:block;padding:10px 16px;color:#d1d1d6;white-space:nowrap;border-bottom:0;text-transform:none;letter-spacing:0
  }
  nav ul li .dropdown li a:hover{background:#25314d;color:#fff}

  /* -------- Gear flyout: redesign sobrio -------- */
  .has-flyout{display:flex;align-items:center;justify-content:space-between;gap:6px;padding:0 8px}
  .has-flyout > a{flex:1;padding:10px 8px}

  .flyout-toggle{
    background:transparent;border:0;cursor:pointer;line-height:1;padding:6px 8px;margin-right:4px;
    color:#d1d1d6;border-radius:8px;transition:background .2s, transform .2s
  }
  .flyout-toggle:hover{background:#25314d;color:#fff}
  .flyout-toggle .chev{display:inline-block;transition:transform .2s ease}

  /* Card affiancata (desktop) */
  .flyout{
    display:none;position:absolute;top:0;left:100%;margin-left:10px;
    background:#101525;border:1px solid #2b2f3a;border-radius:12px;min-width:200px;padding:8px 0;z-index:1001;
    box-shadow:0 14px 34px rgba(0,0,0,.45);
    opacity:0;transform:translateY(6px);transition:opacity .18s ease, transform .18s ease;
  }
  .flyout li a{
    display:block;padding:10px 14px;color:#e5e7eb;text-transform:none;letter-spacing:0;border-radius:8px;margin:2px 8px
  }
  .flyout li a:hover{background:#1f2a44;color:#fff}

  /* Stato aperto */
  .has-flyout.open > .flyout{display:block;opacity:1;transform:translateY(0)}
  .has-flyout.open > .flyout-toggle .chev{transform:rotate(180deg)}

  /* Mobile: mostra sotto come micro‑popup centrato */
  @media (max-width: 640px){
    .flyout{
      left:50%; top:100%; margin:10px 0 0 0; transform:translate(-50%,6px);
      min-width: 220px;
    }
    .has-flyout.open > .flyout{transform:translate(-50%,0)}
    .has-flyout{flex-wrap:wrap}
  }

  /* Backdrop per tap‑outside (mobile & desktop click) */
  #nav-backdrop{
    position:fixed;inset:0;background:transparent;display:none;z-index:900;
  }
  #nav-backdrop.show{display:block}
</style>

<!-- Backdrop per chiudere al tap fuori -->
<div id="nav-backdrop" aria-hidden="true"></div>

<script>
  // evidenzia pagina attiva
  (function(){
    const current = (location.pathname.split("/").pop() || "index.html").toLowerCase();
    document.querySelectorAll('nav a[href]').forEach(a=>{
      const href = a.getAttribute('href')?.toLowerCase();
      if(href === current){
        a.style.color = '#fff';
        a.style.borderBottomColor = '#29abe0';
      }
    });
  })();

  (function(){
    const prefersTouch = window.matchMedia('(hover: none)').matches;
    const nav = document.querySelector('nav');
    const backdrop = document.getElementById('nav-backdrop');

    // Apri/chiudi dropdown principali con TAP su mobile
    document.querySelectorAll('nav li.has-sub > a').forEach(link=>{
      link.addEventListener('click', function(e){
        if (prefersTouch) {
          e.preventDefault();
          const li = this.parentElement;
          const willOpen = !li.classList.contains('open');

          // chiudi tutti
          document.querySelectorAll('nav li.has-sub').forEach(x=>x.classList.remove('open'));
          document.querySelectorAll('.has-flyout').forEach(x=>x.classList.remove('open'));
          document.querySelectorAll('.flyout-toggle').forEach(b=>b.setAttribute('aria-expanded','false'));

          // apri quello cliccato
          if (willOpen) {
            li.classList.add('open');
            backdrop.classList.add('show');
          } else {
            backdrop.classList.remove('show');
          }
        }
      });
    });

    // Gear flyout (toggle con chevron)
    document.querySelectorAll('.has-flyout .flyout-toggle').forEach(btn=>{
      btn.addEventListener('click', function(e){
        e.preventDefault();
        e.stopPropagation();
        const li = this.closest('.has-flyout');
        const expanded = this.getAttribute('aria-expanded') === 'true';

        // chiudi eventuali altri flyout
        document.querySelectorAll('.has-flyout').forEach(x=>x.classList.remove('open'));
        document.querySelectorAll('.flyout-toggle').forEach(b=>b.setAttribute('aria-expanded','false'));

        if (!expanded){
          li.classList.add('open');
          this.setAttribute('aria-expanded','true');
          backdrop.classList.add('show');
        } else {
          li.classList.remove('open');
          this.setAttribute('aria-expanded','false');
          // mantieni backdrop se un dropdown principale è ancora aperto
          if (!document.querySelector('nav li.has-sub.open')) backdrop.classList.remove('show');
        }
      });
    });

    // Click/tap fuori: chiudi tutto (mobile e desktop)
    function closeAll(){
      document.querySelectorAll('nav li.has-sub').forEach(li=>li.classList.remove('open'));
      document.querySelectorAll('.has-flyout').forEach(li=>li.classList.remove('open'));
      document.querySelectorAll('.flyout-toggle').forEach(b=>b.setAttribute('aria-expanded','false'));
      backdrop.classList.remove('show');
    }

    backdrop.addEventListener('click', closeAll, {passive:true});
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeAll(); });

    // Desktop: click fuori dal nav chiude
    document.addEventListener('click', function(e){
      if (!nav.contains(e.target)) closeAll();
    });
    // Mobile: tap fuori (touchstart per iOS/Safari)
    document.addEventListener('touchstart', function(e){
      if (!nav.contains(e.target) && !backdrop.contains(e.target)) closeAll();
    }, {passive:true});
  })();
</script>
