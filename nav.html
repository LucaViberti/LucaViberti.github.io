<header>
  <div class="site-info">
    <h1 class="site-title">TopHeroes Guide</h1>
  </div>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>

      <!-- HEROES -->
      <li class="has-sub">
        <a href="heroes.html">Heroes</a>
        <ul class="dropdown">
          <li><a href="heroes.html">Overview</a></li>
          <li><a href="league.html">League</a></li>
          <li><a href="nature.html">Nature</a></li>
          <li><a href="horde.html">Horde</a></li>
          <!-- Gear con mini flyout affianco -->
          <li class="has-flyout">
            <a href="gear.html">Gear</a>
            <button class="flyout-toggle" aria-label="More for Gear" aria-expanded="false" aria-controls="gear-flyout">▾</button>
            <ul id="gear-flyout" class="flyout">
              <li><a href="exclusive-gear.html">Exclusive Gear</a></li>
            </ul>
          </li>
          <li><a href="pets.html">Pets</a></li>
        </ul>
      </li>

      <!-- BUILDING -->
      <li class="has-sub">
        <a href="building.html">Building</a>
        <ul class="dropdown">
          <li><a href="building.html">Overview</a></li>
          <li><a href="villagers.html">Villagers</a></li>
          <li><a href="lord-gear.html">Lord Gear</a></li>
          <li><a href="relic.html">Relics Hall</a></li>
        </ul>
      </li>

      <li><a href="research.html">Research</a></li>

      <!-- ADVENTURE -->
      <li class="has-sub">
        <a href="generaladv.html">Adventure</a>
        <ul class="dropdown">
          <li><a href="generaladv.html">Overview</a></li>
          <li><a href="classicadv.html">Classic</a></li>
          <li><a href="seasononeadv.html">Season 1</a></li>
        </ul>
      </li>

      <!-- EVENTS  -->
      <li class="has-sub">
        <a href="events.html">Events</a>
        <ul class="dropdown">
          <li><a href="guild-race.html">Guild Race</a></li>
          <li><a href="arms-race.html">Arms Race</a></li>
          <li><a href="kingdom.html">KvK</a></li>
          <li><a href="guildboss.html">Guild Boss</a></li>
        </ul>
      </li>

      <li><a href="beginners.html">Beginners Guide</a></li>
      <li><a href="shop.html">SHOP</a></li>
      <li><a href="tips.html">Tips & More</a></li>

      <!-- SUPPORT US -->
      <li class="has-sub">
        <a href="#">Support Us</a>
        <ul class="dropdown">
          <li><a href="https://ko-fi.com/landaadvice" target="_blank" rel="noopener noreferrer">Ko-fi</a></li>
          <li><a href="https://donate.stripe.com/8x29AT3q37Sl4BJg127AI00" target="_blank" rel="noopener noreferrer">Donate with Stripe</a></li>
        </ul>
      </li>

      <li><a href="privacy.html">Policy&Privacy</a></li>
    </ul>
  </nav>
</header>

<style>
  /* dimensione link coerente */
  nav ul li a { font-size: 0.85rem; }
  nav ul li ul li a { font-size: 0.85rem; }

  /* Titolo */
  .site-title{
    font-size: clamp(1.8rem, 4vw, 2.5rem);
    font-weight:700;
    background: linear-gradient(90deg,#29abe0,#7dd3fc);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    text-align:center;margin:0;padding:8px 0;
    text-shadow:0 2px 4px rgba(0,0,0,0.3);
  }

  /* Dropdown base */
  nav ul{list-style:none;margin:0;padding:0;display:flex;justify-content:center;flex-wrap:wrap;gap:20px}
  nav ul li{position:relative}
  nav ul li a{
    color:#ccd0dd;text-decoration:none;text-transform:uppercase;font-weight:500;letter-spacing:.05em;
    padding:12px 6px;border-bottom:2px solid transparent;transition:color .3s,border-bottom-color .3s
  }
  nav ul li a:hover{color:#fff;border-bottom-color:#29abe0}

  /* dropdown principale */
  nav ul li .dropdown{
    display:none;position:absolute;top:100%;left:50%;transform:translateX(-50%);
    background:#1c2133;border:1px solid #2b2f3a;border-radius:6px;padding:10px 0;min-width:220px;z-index:1000
  }
  @media (hover:hover){
    nav ul li.has-sub:hover > .dropdown{display:block}
  }
  nav ul li.has-sub.open > .dropdown{display:block}

  nav ul li .dropdown li a{
    display:block;padding:8px 16px;color:#d1d1d6;white-space:nowrap;border-bottom:0;text-transform:none;letter-spacing:0
  }
  nav ul li .dropdown li a:hover{background:#25314d;color:#fff}

  /* Gear con flyout */
  .has-flyout{display:flex;align-items:center;justify-content:space-between;gap:6px;padding:0 8px}
  .has-flyout > a{flex:1;padding:8px 8px}
  .flyout-toggle{
    background:#25314d;border:1px solid #2b2f3a;border-radius:6px;padding:6px 8px;
    color:#d1d1d6;cursor:pointer;font-size:.8rem;line-height:1
  }
  .flyout-toggle:hover{background:#2d3a5a;color:#fff}
  .flyout{
    display:none;position:absolute;
    top:0; left:100%; margin-left:8px;
    background:#1c2133;border:1px solid #2b2f3a;border-radius:6px;min-width:180px; padding:8px 0; z-index:1001
  }
  .has-flyout.open > .flyout{display:block}
  @media (max-width: 640px){
    .flyout{position:static; margin:6px 0 0 0; left:auto; top:auto; display:none;}
    .has-flyout.open > .flyout{display:block}
    .has-flyout{flex-wrap:wrap}
    .flyout-toggle{padding:6px 10px}
  }

  /* FIX: garantisce click sicuri */
  nav { position: relative; z-index: 10; }
  nav ul li .dropdown li a { position: relative; z-index: 2; }
</style>

<script>
  // Evidenzia la pagina attiva
  (function(){
    const current = (location.pathname.split("/").pop() || "index.html").toLowerCase();
    document.querySelectorAll('nav a[href]').forEach(a=>{
      const href = a.getAttribute('href')?.toLowerCase();
      if(href === current){
        a.style.color = '#fff';
        a.style.borderBottomColor = '#29abe0';
      }
    });
  })();

  // Apertura/chiusura dropdown (mobile) + 2° tap = naviga
  (function(){
    const isTouch = window.matchMedia('(hover: none)').matches;

    document.querySelectorAll('nav li.has-sub > a').forEach(link=>{
      link.addEventListener('click', function(e){
        const li = this.parentElement;
        if (!isTouch) return; // desktop normale

        if (!li.classList.contains('open')) {
          e.preventDefault();
          li.classList.add('open');
          document.querySelectorAll('nav li.has-sub').forEach(other=>{
            if(other !== li) other.classList.remove('open');
          });
          return;
        }
      });
    });

    // voci interne navigano sempre
    document.querySelectorAll('nav li .dropdown a').forEach(a=>{
      a.addEventListener('click', e=>{
        e.stopPropagation();
      });
    });

    // Gear flyout
    document.querySelectorAll('.has-flyout .flyout-toggle').forEach(btn=>{
      btn.addEventListener('click', function(e){
        e.stopPropagation();
        const li = this.closest('.has-flyout');
        const expanded = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', expanded ? 'false' : 'true');
        li.classList.toggle('open', !expanded);
      });
    });

    // Chiudi fuori
    document.addEventListener('click', function(e){
      const nav = document.querySelector('nav');
      if(!nav.contains(e.target)){
        document.querySelectorAll('nav li.has-sub').forEach(li=>li.classList.remove('open'));
        document.querySelectorAll('.has-flyout .flyout-toggle').forEach(btn=>btn.setAttribute('aria-expanded','false'));
        document.querySelectorAll('.has-flyout').forEach(li=>li.classList.remove('open'));
      }
    });

    // Chiudi con Esc
    document.addEventListener('keydown', function(e){
      if(e.key === 'Escape'){
        document.querySelectorAll('nav li.has-sub').forEach(li=>li.classList.remove('open'));
        document.querySelectorAll('.has-flyout .flyout-toggle').forEach(btn=>btn.setAttribute('aria-expanded','false'));
        document.querySelectorAll('.has-flyout').forEach(li=>li.classList.remove('open'));
      }
    });
  })();
</script>
